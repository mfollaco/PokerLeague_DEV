<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Chip &amp; A Chair Poker League – Home</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Bootstrap 5 -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />

  <!-- Icons -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" />

  <!-- Custom Vegas Theme -->
  <link rel="stylesheet" href="css/vegas.css">
</head>

<body class="bg-vegas text-light">

  <!-- NAVBAR -->
  <nav class="navbar navbar-expand-lg navbar-dark bg-vegas-dark border-bottom border-gold">
    <div class="container">
      <a class="navbar-brand neon-gold" href="index.html">♠ Home ♣</a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navMain">
        <span class="navbar-toggler-icon"></span>
      </button>

      <div class="collapse navbar-collapse" id="navMain">
        <ul class="navbar-nav ms-auto">
          <a class="nav-link cac-link"
            href="leaderboard.html">
            Leaderboard
          </a>
          <a class="nav-link cac-link"
            href="chip-and-chair.html">
            Chip & A Chair
          </a>
          <a class="nav-link cac-link"
            href="weekly-results.html">
            Weekly Results
          </a>
          <a class="nav-link cac-link"
            href="schedule.html">
            Schedule
          </a>
          <a class="nav-link cac-link"
            href="analytics.html">
            Analytics
          </a>
          
        </ul>
      </div>
    </div>
  </nav>

  <!-- HERO -->
  <header class="vegas-hero d-flex align-items-center">
    <div class="container text-center">
      
      <p class="lead hero-tagline-vegas mb-4">
        Crushed Dreams. Real bragging rights. Minor yelling.
      </p>
      <h1 class="display-3 neon-title mb-3">Chip &amp; A Chair Poker League</h1>
      <div class="d-flex justify-content-center gap-3 flex-wrap">
        <span class="badge badge-vegas-gold fs-6">Spring Season 2026</span>
        <span class="badge badge-vegas-outline fs-6">"C U Next Tuesday!"</span>
      </div>
    </div>
  </header>

  <!-- MAIN CONTENT -->
  <main class="py-5">
    <div class="container">
      <div class="row g-4">

        <!-- Next Event -->
        <div class="col-md-4">
          <div class="card card-vegas h-100">
            <div class="card-header border-gold-bottom">
              <h5 class="mb-0"><i class="bi bi-calendar-event me-2 text-gold"></i>Next Event</h5>
            </div>
            <div class="card-body" id="next-event">
              <p class="text-muted mb-0">Coming Next Season</p>
            </div>
          </div>
        </div>

        <!-- Latest Winner -->
        <div class="col-md-4">
          <div class="card card-vegas h-100">
            <div class="card-header border-gold-bottom">
              <h5 class="mb-0"><i class="bi bi-trophy-fill me-2 text-gold"></i>Latest Winner</h5>
            </div>
            <div class="card-body" id="latest-winner">
              <p class="text-muted mb-0">Loading latest winner…</p>
            </div>
          </div>
        </div>

        <!-- Current Leaders -->
        <div class="col-md-4">
          <div class="card card-vegas h-100">
            <div class="card-header border-gold-bottom">
              <h5 class="mb-0"><i class="bi bi-bar-chart-line-fill me-2 text-gold"></i>Current Leaders</h5>
            </div>
            <div class="card-body" id="current-leaders">
              <p class="text-muted mb-0">Loading leaderboard…</p>
            </div>
          </div>
        </div>

      </div>

      <section class="mt-5">
        <h2 class="neon-subtitle mb-3">Season Overview</h2>
        <p class="text-muted-vegas">
          This site tracks every event, finish, and chip swing of the seasons.
        </p>
      </section>
    </div>
  </main>

  <!-- FOOTER -->
  <footer class="py-4 border-top border-gold mt-auto bg-vegas-dark">
    <div class="container text-center small text-muted-vegas">
      ♠ ♥ ♦ ♣ Chip &amp; A Chair Poker League • Rochester, NY • Spring Season 2026 ♣ ♦ ♥ ♠
    </div>
  </footer>

  <!-- DATA LOADER -->
  <script>
    async function loadSeasonData() {
      try {
        // ✅ correct path (your JSON lives in /data/)
        const SEASON_ID = "spring_2026";
        const url = `data/${SEASON_ID}.json`;

        const res = await fetch(url, { cache: "no-store" });
        if (!res.ok) throw new Error(`Failed to load ${url}: ${res.status}`);

        const data = await res.json();

        // ----------------------------
        // Latest winner (derive from WeeklyPoints)
        // ----------------------------
        const weekly = data.WeeklyPoints || [];

        // find latest week number present
        const latestWeek = weekly.reduce((m, r) => Math.max(m, Number(r.Week || 0)), 0);

        // winner row = FinishPlace 1 in latest week
        const winnerRow = weekly.find(
          (r) => Number(r.Week) === latestWeek && Number(r.FinishPlace) === 1
        );

        const latestEl = document.getElementById("latest-winner");
        if (latestEl) {
          if (winnerRow) {
            const cash = Number(winnerRow.Payout || 0);
            latestEl.innerHTML = `
              <h6 class="text-gold">${winnerRow.Player}</h6>
              <p class="mb-1">Week ${latestWeek}</p>
              <p class="mb-0"><strong>Cash:</strong> ${cash.toLocaleString(undefined, {
                style: "currency",
                currency: "USD",
                maximumFractionDigits: 0
              })}</p>
            `;
          } else {
            latestEl.innerHTML = `<p class="mb-0 text-muted">No winner found yet.</p>`;
          }
        }

        // ----------------------------
        // Current leaders (derive from SeasonTotals)
        // ----------------------------
        const totals = data.SeasonTotals || [];

        // sort by Drop2 points desc
        const leaders = [...totals]
          .sort((a, b) => Number(b.SeasonPointsDrop2 || 0) - Number(a.SeasonPointsDrop2 || 0))
          .slice(0, 5)
          .map((r) => ({
            name: r.Player,
            points: Number(r.SeasonPointsDrop2 || 0),
          }));

        const leadersEl = document.getElementById("current-leaders");
        if (leadersEl) {
          if (leaders.length) {
            leadersEl.innerHTML = `
              <ol class="mb-0 ps-3">
                ${leaders
                  .map(
                    (p) => `
                      <li class="mb-1">
                        <span class="text-gold">${p.name}</span>
                        <span class="text-muted-vegas"> • ${p.points} pts</span>
                      </li>
                    `
                  )
                  .join("")}
              </ol>
            `;
          } else {
            leadersEl.innerHTML = `<p class="mb-0 text-muted">No standings yet.</p>`;
          }
        }

      } catch (err) {
        console.error(err);
      }
    }

  loadSeasonData();
</script>

  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

</body>
</html>